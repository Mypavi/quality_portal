<mvc:View
    controllerName="quality.controller.UsageDecision"
    xmlns:mvc="sap.ui.core.mvc"
    displayBlock="true"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core">
    
    <Page title="Usage Decisions" showNavButton="true" navButtonPress="onNavBack" class="usagePage">
        
        <customHeader>
            <Bar class="usageHeader">
                <contentLeft>
                    <Button icon="sap-icon://nav-back" press="onNavBack"/>
                    <Title text="Usage Decisions" level="H2"/>
                </contentLeft>
                <contentRight>
                    <Button icon="sap-icon://download" press="onExport" tooltip="Export"/>
                    <Button icon="sap-icon://refresh" press="onRefresh" tooltip="Refresh"/>
                </contentRight>
            </Bar>
        </customHeader>
        
        <content>
            <VBox class="usageContent">
                
                <!-- Filters Panel -->
                <Panel headerText="Filters" class="usageFilters">
                    <content>
                        <VBox>
                            <HBox class="filterGrid">
                                <VBox>
                                    <Label text="Plant:"/>
                                    <Select selectedKey="{usage>/filters/plant}">
                                        <core:Item key="" text="All Plants"/>
                                        <core:Item key="0001" text="0001 - werk_01"/>
                                        <core:Item key="1003" text="1003 - MK"/>
                                        <core:Item key="1008" text="1008 - SW"/>
                                    </Select>
                                </VBox>
                                <VBox>
                                    <Label text="Decision Status:"/>
                                    <Select selectedKey="{usage>/filters/status}">
                                        <core:Item key="" text="All Statuses"/>
                                        <core:Item key="Allowed" text="Allowed"/>
                                        <core:Item key="Blocked" text="Blocked"/>
                                        <core:Item key="Checked" text="Checked"/>
                                    </Select>
                                </VBox>
                                <VBox>
                                    <Label text="Lot Number:"/>
                                    <Input 
                                        value="{usage>/filters/lotNumber}" 
                                        placeholder="Search by lot number"/>
                                </VBox>
                            </HBox>
                            
                            <HBox class="filterButtons">
                                <Button text="Clear Filters" press="onClearFilters" type="Transparent"/>
                                <Button text="Apply Filters" press="onApplyFilters" type="Emphasized"/>
                            </HBox>
                        </VBox>
                    </content>
                </Panel>
                
                <!-- Usage Decisions Table -->
                <f:Card class="usageTableCard">
                    <f:header>
                        <f:Header title="Usage Decisions"/>
                    </f:header>
                    <f:content>
                        <Table 
                            id="usageDecisionTable"
                            items="{usage>/usageDecisions}"
                            growing="true"
                            growingThreshold="20"
                            busy="{usage>/isLoading}">
                            
                            <columns>
                                <Column>
                                    <Text text="Lot Number"/>
                                </Column>
                                <Column>
                                    <Text text="Plant"/>
                                </Column>
                                <Column>
                                    <Text text="Quantities"/>
                                </Column>
                                <Column>
                                    <Text text="Progress"/>
                                </Column>
                                <Column>
                                    <Text text="Decision Code"/>
                                </Column>
                                <Column>
                                    <Text text="Status"/>
                                </Column>
                                <Column>
                                    <Text text="Message"/>
                                </Column>
                                <Column>
                                    <Text text="Actions"/>
                                </Column>
                            </columns>
                            
                            <items>
                                <ColumnListItem press="onUsageDecisionPress" type="Active">
                                    <cells>
                                        <Text text="{usage>InspectionLotNumber}" class="lotNumber"/>
                                        <Text text="{usage>Plant}"/>
                                        <VBox>
                                            <Text text="Total: {usage>LotQuantity}"/>
                                            <Text text="Inspected: {usage>InspectedQuantity}"/>
                                        </VBox>
                                        <ProgressIndicator 
                                            percentValue="{usage>QuantityProgress}"
                                            displayValue="{usage>QuantityProgress}%"
                                            class="progressBar"/>
                                        <Text text="{usage>DecisionCodeText}" class="decisionCode"/>
                                        <ObjectStatus 
                                            text="{usage>DecisionStatus}"
                                            state="{usage>StatusState}"
                                            class="decisionStatus"/>
                                        <Text text="{usage>DecisionMessage}" class="decisionMessage"/>
                                        <Button 
                                            text="Details" 
                                            type="Transparent"
                                            press="onUsageDecisionPress"/>
                                    </cells>
                                </ColumnListItem>
                            </items>
                            
                        </Table>
                    </f:content>
                </f:Card>
                
                <!-- Summary Statistics -->
                <Panel headerText="Summary Statistics" class="summaryPanel">
                    <content>
                        <HBox class="summaryStats" justifyContent="SpaceAround">
                            <VBox alignItems="Center">
                                <Text text="{= ${usage>/usageDecisions}.filter(function(d) { return d.DecisionStatus === 'Allowed'; }).length }" class="summaryNumber"/>
                                <Text text="Allowed" class="summaryLabel"/>
                            </VBox>
                            <VBox alignItems="Center">
                                <Text text="{= ${usage>/usageDecisions}.filter(function(d) { return d.DecisionStatus === 'Blocked'; }).length }" class="summaryNumber"/>
                                <Text text="Blocked" class="summaryLabel"/>
                            </VBox>
                            <VBox alignItems="Center">
                                <Text text="{= ${usage>/usageDecisions}.filter(function(d) { return !d.UsageDecisionCode; }).length }" class="summaryNumber"/>
                                <Text text="Pending" class="summaryLabel"/>
                            </VBox>
                            <VBox alignItems="Center">
                                <Text text="{usage>/usageDecisions/length}" class="summaryNumber"/>
                                <Text text="Total" class="summaryLabel"/>
                            </VBox>
                        </HBox>
                    </content>
                </Panel>
                
            </VBox>
        </content>
        
    </Page>
    
</mvc:View>